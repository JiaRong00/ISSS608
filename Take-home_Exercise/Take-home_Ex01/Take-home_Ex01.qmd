---
title: "Take-home Exercise 1"
format:
  html:
    fontcolor: '#3b3b3b'
    code-line-numbers: true
author: "Moo Jia Rong"
date: "February 1, 2025"
date-modified: "last-modified"
execute:
  echo: true
  eval: true
  warning: false
  freeze: true 
---

### **1 Overview**

#### **1.1 Background**

Heart attack is one of the leading causes of mortality globally. According to findings of [research studies](https://www.sciencedaily.com/releases/2019/03/190307081026.htm), heart attacks are increasingly common in young adults (aged 40 or below). The alarming trend highlights a need to understand the potential causes and risk factors of early heart attacks through examining the profiles of young adult and older adult patients, including demographic, lifestyle factors and medical history, to enable early detection and enforcement of preventive measures.

#### **1.2 Dataset**

In this exercise, we have obtained a dataset on heart attack incidents in Japan from [Kaggle](https://www.kaggle.com/datasets/ashaychoudhary/heart-attack-in-japan-youth-vs-adult), consisting of data on individuals aged 18 to 79.

#### **1.3 Objectives**

As part of an international media company that publishes weekly content on digital platforms, we will Use the Japan heart attack dataset to perform Exploratory Data Analysis (EDA) and generate visualisations for an article, covering insights on:

(1) The general profile of Japan population
(2) Trends in heart attack occurrence in the Japan populations
(3) Correlations between ??

### **2 Getting Started**

#### **2.1 Loading Packages**

```{r}
pacman::p_load(tidyverse,knitr, patchwork,ggpubr, plotly,ggridges,ggdist,ggmosaic)
```

#### **2.2 Importing Data**

The dataset used in this exercise is the *japan_heart_attack_dataset.csv* file downloaded from Kaggle. The file is imported into R environment using `read_csv()`.

Using the `glimpse()` function, we observe that the dataset consists of 30,000 records spanning across 32 columns. Of which, there are 17 relevant variables and 15 extra column variables which are irrelevant to our analysis.

In addition, by viewing the first few entries of each column, we can see that there are both categorical and continuous variables in the dataset.

With a focus on the 17 relevant variables, a data dictionary table is generated, showing the range for the 7 continuous variables and the unique values for the 10 categorical variables.

::: panel-tabset
## Import data

```{r}
heart_attack <- read_csv("data/japan_heart_attack_dataset.csv")
```

## Glimpse data

```{r}
glimpse(heart_attack)
```

## Data dictionary

```{r}
#| code-fold: true
#| code-summary: "Show the code"
data_dict <- data.frame(matrix(ncol = 3, nrow = 0))
x <- c("Variable", "Type", "Values")
colnames(data_dict) <- x

column_names <- colnames(heart_attack)[1:17]
for (column in column_names){
  values <- heart_attack[, column]
  if (class(heart_attack[[column]])=="numeric"){
    col_label<-paste0("(", round(min(values), digits=2), ", ", round(max(values), digits=2), ")")
    col_type="Continuous"
  }
  else {
    col_label<-paste0(unique(values))
    col_type="Categorical"
  }
  new.row <- data.frame(Variable = column, Type = col_type , Values = col_label)
  data_dict <- rbind(data_dict, new.row)
  
}

data_dict["Description"]<- c("","","","","", "Patient hypertension ( high blood pressure) history
", "normal total cholesterol level (mg/dL) < 200 
", "","","","", "Healthy BMI range is 18.5 to 24.9
", "", "Normal systolic  blood pressure (mmHg) <120 
", "Normal diastolic  blood pressure (mmHg) <80
", "","")

knitr::kable(data_dict, "html")
```
:::

### **3 Data Wrangling**

#### **3.1 Removing irrelevant data**

We first remove the 15 'extra columns' in the dataset, which are irrelvant for our analysis, using the code below.

```{r}
df<-heart_attack[, 1:17]
```

This leaves us with just 17 variables:

[General Demographic Variables]{.underline}

-   Age
-   Gender
-   Region
-   BMI

[Lifestyle Factors]{.underline}

-   Smoking_History
-   Physical_Activity
-   Diet_Quality
-   Alcohol_Consumption
-   Stress_Levels

[Medical History]{.underline}

-   Diabetes_History
-   Hypertension_History
-   Cholesterol_Level
-   Heart_Rate
-   Systolic_BP
-   Diastolic_BP
-   Family_History
-   Heart_Attack_Occurrence

#### **3.2 Check for duplicated or missing values**

Next, the `duplicated()` and `is.na()` functions are used to check for duplicate records and missing values in the dataset respectively.

There are no duplicated records or missing values in this dataset.

::: panel-tabset
## Duplicated records

```{r}
df[duplicated(df),]
```

## Missing values

```{r}
sum(is.na(df))
```
:::

#### **3.3 Recode Age**

The age distribution in the population is shown in the histogram below. There is a relatively even spread of records from young to old.

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(df, aes(Age)) +
  geom_histogram(bins=20, 
                 boundary = 100,
                 color="black", 
                 fill="#7F948F") +
  labs(title = "Frequency of Age")
```

To facilitate comparison of profiles of younger versus older heart attack patients, we can create a new variable named *Age_Group* to bin the records into different age groups:

1)  Young Adults: 18-39
2)  Middle-aged Adults: 40-65
3)  Old Adults: 66-79

```{r}
df$Age_Groups <- ifelse(df$Age<=35, "Young", ifelse(df$Age<=65, "Middle-aged", "Old"))
```

#### **3.4 Recode BMI**

The BMI distribution in the population is shown in the histogram below. We can observe that the BMI distribution resembles a normal distribution and about half of the population has BMI \> 25, which is above the healthy range. For better comparisons in our analyses, we should bin BMI.

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(df, aes(BMI)) +
  geom_histogram(boundary = 100,
                 color="black", 
                 fill="#7F948F") +
  labs(title = "Frequency of BMI")
```

BMI can be further categorised according to the criterion below, according to definition by Centers for Disease Control and Prevention:

-   Underweight: \<18.5
-   Normal: 18.5 to \<25
-   Overweight: 25 to \<30
-   Obese: â‰¥30

```{r}
df$BMI_Category <- ifelse(df$BMI<18.5, "Underweight", 
                          ifelse(df$BMI<25, "Normal", 
                                 ifelse(df$BMI<30, "Overweight", "Obese")))
```

#### **3.5 Creating blood pressure variable**

As the dataset provides the Systolic and Diastolic Blood Pressures, we can use these information to further categorise the population based on their blood pressure category, according to the criterion shown in the figure below.

![Source: American Heart Association](images/clipboard-3164247285.png)

The distribution of the Systolic and Diastolic blood pressures are shown in the figure below. There are no records with hypertensive crisis (Systolic BP \> 180 mmHg or Diastolic BP \> 120 mmHg). Therefore, we will only have 4 blood pressure groups: Normal, Elevated, Hypertension I and Hypertension II.

```{r}
#| code-fold: true
#| code-summary: "Show the code"
p1<-ggplot(df, aes(Systolic_BP)) +
  geom_histogram(bins=20,
                 boundary = 100,
                 color="black", 
                 fill="thistle") +
  scale_x_continuous(n.breaks = 10) +
  labs(title = "Frequency of Systolic BP") +
  xlab("Systolic BP (mmHg)")

p2<-ggplot(df, aes(Diastolic_BP)) +
  geom_histogram(bins=20,
                 boundary = 100,
                 color="black", 
                 fill="lightsteelblue") +
  labs(title = "Frequency of Diastolic BP")+
  xlab("Diastolic BP (mmHg)")

p1 + p2 + plot_annotation(tag_levels = 'I')
```

```{r}
df$Blood_Pressure <- ifelse(df$Systolic_BP<120 & df$Diastolic_BP<80, "Normal", 
                            ifelse(df$Systolic_BP<130 & df$Diastolic_BP<80, "Elevated", 
                                   ifelse((df$Systolic_BP>=130 & df$Systolic_BP<140)|
                                            ( df$Diastolic_BP<90 & df$Diastolic_BP>=80), "Hypertension I", "Hypertension II")))
```

#### **3.6 Ordering levels for ordinal categorical variables**

For ordinal categorical variables, we will order the different levels in an ascending order using `factor()`, so that the results will be displayed according to the order we have set in the graphs we will plot subsequently in our analysis.

```{r}
df$Physical_Activity <- factor(df$Physical_Activity, 
                               levels = c("Low", "Moderate", "High"), ordered = TRUE )

df$Diet_Quality <- factor(df$Diet_Quality, 
                          levels = c("Poor", "Average", "Good"), ordered = TRUE)

df$Alcohol_Consumption <- factor(df$Alcohol_Consumption, 
                                 levels = c("None", "Low", "Moderate", "High"), ordered = TRUE)

df$Age_Groups <- factor(df$Age_Groups, 
                                 levels = c("Young", "Middle-aged", "Old"), ordered = TRUE)

df$BMI_Category <- factor(df$BMI_Category, 
                                 levels = c("Underweight", "Normal", "Overweight", "Obese"), ordered = TRUE)

df$Blood_Pressure <- factor(df$Blood_Pressure, 
                                 levels = c("Normal", "Elevated", "Hypertension I", "Hypertension II"), ordered = TRUE)
```

The first 5 results of the final dataset are displayed below using `kable()` of the knitr package.

```{r}
kable(head(df, n=5), caption = "Heart Attack in Japan")
```

### **4 Exploratory Data Analysis**

In this section, we will be conducting Exploratory Data Analysis on the processed dataset named *df*.

#### **4.1 Univariate Analysis**

Before diving into multivariate analysis, we first take a look at the distribution of some of the key variables closely-linked to heart attack in the Japan population: Age group, Blood Pressure, BMI category and heart attack occurrence.

```{r}
#| code-fold: true
#| code-summary: "Show the code"
p1<-ggplot(data=df,aes(x=Age_Groups, fill=Age_Groups))+
  geom_bar(stat = "count")+
  scale_fill_manual(values=c("lightsteelblue","lightcyan3","thistle"))+
  geom_text(
    aes(
      label = scales::percent(..count../sum(..count..), accuracy = 0.1)  # Calculate percentage using sum of counts
    ),
    stat = "count",
    vjust = 1.5,  # Adjust text placement 
    size=3
  ) +
  theme(axis.ticks.x = element_blank(), legend.position = "None")+
  labs(x = "Age Group", fill="Age Group")

p2<-ggplot(data=df,aes(x=Blood_Pressure, fill=Blood_Pressure))+
  geom_bar(stat = "count")+
  scale_fill_manual(values=c("lightsteelblue","lightcyan3","thistle","rosybrown2" ))+
  geom_text(
    aes(
      label = scales::percent(..count../sum(..count..), accuracy = 0.1)  # Calculate percentage using sum of counts
    ),
    stat = "count",
    vjust = 1.5,  # Adjust text placement 
    size=3
  ) +
  theme( axis.ticks.x = element_blank(), legend.position = "None" )+
  labs(x = "Blood Pressure", fill="Blood Pressure")

p3<- ggplot(data=df,aes(x=Heart_Attack_Occurrence, fill=Heart_Attack_Occurrence))+
  geom_bar(stat = "count")+
  scale_fill_manual(values=c("lightsteelblue","thistle" ))+
  geom_text(
    aes(
      label = scales::percent(..count../sum(..count..), accuracy = 0.1)  # Calculate percentage using sum of counts
    ),
    stat = "count",
    vjust = 1.5,  # Adjust text placement 
    size=3
  ) +
  theme( axis.ticks.x = element_blank(), legend.position = "None" )+
  labs(x = "Heart Attack Occurrence", fill="Heart Attack")

p4<- ggplot(data=df,aes(x=BMI_Category, fill=BMI_Category))+
  geom_bar(stat = "count")+
  scale_fill_manual(values=c("lightsteelblue","lightcyan3","thistle","rosybrown2" ))+
  geom_text(
    aes(
      label = scales::percent(..count../sum(..count..), accuracy = 0.1)  # Calculate percentage using sum of counts
    ),
    stat = "count",
    vjust = 1.5,  # Adjust text placement 
    size=3
  ) +
  theme( axis.ticks.x = element_blank(), legend.position = "None" )+
  labs(x = "BMI Category", fill="BMI")

p1+p2+p3+p4+ plot_annotation(title= "Overview of Japan Population Profile")+
  plot_layout(widths = c(1, 2))
```

::: {.callout-note icon="false"}
## Insights

-   The majority of the study population are Middle-aged (40-65), followed by Young adults (18-39) and Old adults (\>65).
-   About 10% of the population has had heart attack, indicating high prevalence of heart attack in Japan and underscores importance of addressing cardiovascular health.
-   Alarmingly, only 25.2% of the population has normal blood pressure, with almost 2/3 (62.6%) suffering from hypertension. Prolonged hypertension is a well-documented contributor to cardiovascular diseases, including heart attacks and strokes.
-   Nearly half of the population (49.8%) are either overweight or obese, which is known to be a significant risk factor for heart attack occurrence and correlates with other comorbidities such as diabetes and high cholesterol, exacerbating health conditions.
-   The high incidence of hypertension, overweight and obesity highlights a need for targeted public health campaigns to increase awareness to promote healthy lifestyles and targeted preventive measures such as early detections and lifestyle modifications.
:::

#### **4.2 Association of Heart Attack with Hypertension**

Next, we delve into bivariate analyses to understand correlation of heart attack with various factors. Given the high incidence of hypertension observed in the previous section, we will investigate whether hypertension is associated with an increased risk of heart attack. 

```{r}
#| code-fold: true
#| code-summary: "Show the code"
p1<-ggplot(data=df) +
  geom_mosaic(aes(x = product(Heart_Attack_Occurrence,Blood_Pressure), fill=Heart_Attack_Occurrence))+
  theme(legend.position="right") +
  labs(x = "Blood Pressure",
       y = "Heart Attack")+
scale_fill_manual("Heart Attack",values=c( "lightsteelblue", "thistle"))+
  scale_y_continuous(labels = scales::percent)

p2<-ggplot(data=df, aes(y=Heart_Attack_Occurrence, x=Systolic_BP, fill=Heart_Attack_Occurrence)) +
  geom_density_ridges(alpha = 0.8, quantile_lines=TRUE, quantiles = 2)+
scale_fill_manual("Heart Attack",values=c( "lightsteelblue","thistle"))+
  theme(legend.position="None")+
  labs(y = "Heart Attack",
       x = "Systolic BP")

p3<-ggplot(data=df, aes(y=Heart_Attack_Occurrence, x=Diastolic_BP, fill=Heart_Attack_Occurrence)) +
  geom_density_ridges(alpha = 0.8, quantile_lines=TRUE, quantiles = 2)+
scale_fill_manual("Heart Attack",values=c( "lightsteelblue","thistle"))+
  theme(legend.position="None", axis.title.y = element_blank())+
  labs(x = "Diastolic BP")

p1/(p2+p3) + plot_layout(axis_titles = "collect")+ plot_annotation(title= "Heart Attack is not significantly associated with Hypertension")

```

::: {.callout-note icon="false"}
## Insights

-   Heart attack occurrence does not significantly increase in groups with hypertension or elevated blood pressure, compared to normal blood pressure. This suggests that high blood pressure alone may only have a small impact on heart attack risk or that medication adherence and lifestyle modifications could play a role in mitigating the associated risks. The overall heart attack risk for an individual may only become more pronounced when multiple factors are accounted for, as presence of multiple risk factors simultaneously compounds the overall risks since each condition can exacerbate the others.  

:::

#### **4.3 Association of Heart Attack with Age, Gender and BMI**

In this section, we will examine if biological factors like aging and gender are correlated with heart attack.

```{r}
#| code-fold: true
#| code-summary: "Show the code"
p1<-ggplot(df, 
       aes(x = Heart_Attack_Occurrence, 
           fill=Gender))+
  geom_bar(stat = "count")+
  scale_fill_manual(values=c("#DF9999","#99AEDF"))+
  geom_text(
    aes(
      label = scales::percent(..count../sum(..count..), accuracy = 0.1)  # Calculate percentage using sum of counts
    ),
    stat = "count",
    position = position_stack(vjust = 0.5),  # Adjust text placement 
    size=3
  ) +
  theme( axis.ticks.x = element_blank(), legend.position = "bottom" )+
  labs(x = "Heart Attack Occurrence", fill="Gender")

p2<-ggplot(df)+
    geom_mosaic(aes(x = product(Heart_Attack_Occurrence, Age_Groups), fill=Heart_Attack_Occurrence))+
  scale_fill_manual(values=c("lightsteelblue","thistle")) +
  theme( axis.ticks.x = element_blank(), legend.position = "bottom" )+
  labs(x = "Age Group", y= "Heart Attack Occurrence", fill="Heart Attack")+ 
  scale_y_continuous(labels = scales::percent)

p1+p2+ plot_annotation(title= "Heart attack occurrence is similar across Gender and Age groups")
```

::: {.callout-note icon="false"}
## Insights

-   Based on the stacked bar chart above, the chances of having heart attack is similar for both genders. This suggests that gender is not be a significant differentiator for heart attack occurrence in this study population.
-   Surprisingly, the proportion of Young adults having heart attack is comparable to that of Middle-aged and Old adults. This finding is in disaccordance with common assumptions of heart attack occurring predominantly in older adults, signifying that heart attack may become more common in young adults in the future. Understanding causes and risk factors for heart attack in young adults is therefore pertinent, for the development of effective prevention strategies and government-initiated public health interventions.

:::

```{r}
#| code-fold: true
#| code-summary: "Show the code"
p1<-ggplot(df, 
       aes(x = Age_Groups, 
           y = BMI,
           fill=Gender)) +
  stat_halfeye(adjust = 0.5,
               justification = -0.1,
               .width = 0,
               point_colour = NA,
                position = position_dodge(0.1)) +
  geom_boxplot(width = .2,
               position = position_dodge(0.3),
               outlier.shape = NA) +
  labs(x = "",
       y = "BMI") +   
  theme(
    legend.position = "right",
    #panel.grid.major = element_blank(),
    axis.title.y = element_text(hjust=1, angle=0)) +
  coord_flip()+
  scale_fill_manual(values=alpha(c("thistle", "lightsteelblue"),0.35))

p2<-ggplot(data=df, aes(x=Heart_Attack_Occurrence, y=BMI, fill=Heart_Attack_Occurrence)) +
  geom_violin()+
  geom_boxplot(width=0.1,alpha=0.2, fill="white")+
scale_fill_manual("Heart Attack",values=c( "lightsteelblue","thistle"))+
  theme(legend.position="right")+
  labs(x = "Heart Attack",
       y = "BMI")+ theme(axis.title.y = element_text(vjust = -14))

p3<-ggplot(data=df) +
  geom_mosaic(aes(x = product(Heart_Attack_Occurrence,BMI_Category), fill=Heart_Attack_Occurrence))+
  theme(legend.position="None") +
  labs(x = "BMI",
       y = "Heart Attack")+
scale_fill_manual(values=c( "lightsteelblue", "thistle"))+
  scale_y_continuous(labels = scales::percent)

cmb<-p2+p3+ plot_layout(guides = "collect")+
  plot_layout(widths = c(1, 3))
p1/cmb+ plot_annotation(title= "Heart attack occurrence is similar across BMI categories")
```

::: {.callout-note icon="false"}
## Insights

-   Distribution of BMI is consistent across age group and gender, resembing a normal distribution. This indicates that BMI is not associated with gender or age in the population.
-   Interestingly, heart attack occurrence does not show significant variation across BMI categories. This suggests that BMI is not a strong differentiator for heart attack occurrence in this study population and that other factors, such as underlying medical conditions or lifestyle behaviors, may be a better predictor of heart attack occurrence than BMI alone.

:::

#### **4.4 Cholesterol level**



#### **4.5 Association of Heart Attack with Medical Conditions and History**

Heart attack is typically caused by a combination of various interrelated risk factors. Therefore, it is essential to examine other factors such as underlying medical conditions, family history, and lifestyle choices. These factors may interact in complex ways, increasing the likelihood of heart attacks.

In this section, we will investigate if Diabetes History, Family History and Cholesterol level increases tendency of heart attack occurrence.

```{r}
p1<-ggplot(data=df) +
  geom_mosaic(aes(x = product(Heart_Attack_Occurrence,Diabetes_History), fill=Heart_Attack_Occurrence))+
  theme(legend.position="right") +
  labs(x = "Diabetes History",
       y = "Heart Attack Occurrence")+
scale_fill_manual("Heart Attack",values=c( "lightsteelblue", "thistle"))+
  facet_wrap(~Age_Groups) + 
  scale_y_continuous(labels = scales::percent)

p2<-ggplot(data=df) +
  geom_mosaic(aes(x = product(Heart_Attack_Occurrence,Family_History), fill=Heart_Attack_Occurrence))+
  theme(legend.position="right") +
  labs(x = "Family History",
       y = "Heart Attack Occurrence")+
scale_fill_manual("Heart Attack",values=c( "lightsteelblue", "thistle"))+
  facet_wrap(~Age_Groups) + 
  scale_y_continuous(labels = scales::percent)
p2
```

::: {.callout-note icon="false"}
## Insights

-   Based on the figure, we can observe that heart attack occurrence is relatively similar in middle-aged and old adults with or without diabetes history. However, percentage of young adults with heart attack was slightly higher in those with diabetes history compared to without.
-   Percentage of individuals with heart attack did not differ significantly between groups with or without family history, across the age groups.

:::

#### **4.6:**

#### **4.7:**

### **5 Conclusion**
Other factors, such as the presence of additional risk factors (e.g., high cholesterol, smoking, obesity, or diabetes), the duration and severity of hypertension, and genetic predispositions, play a critical role in determining an individual's overall risk.

### **6 References**
